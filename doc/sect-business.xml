<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbookxi.rng" type="xml"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook V5.0/EN"
				"http://www.docbook.org/xml/5.0/dtd/docbook.dtd" [
<!ENTITY % myent SYSTEM "entities.ent">
%myent;
]>
<book
	xml:lang="it"
	xmlns="http://docbook.org/ns/docbook"
	xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    version="5.0">
    <chapter>
        <title/>
        <section xml:id="sect-business">
            <title>Business</title>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        	<section>
        		<title>Introduzione alle scelte progettuali</title>
        		<para>
        			Come già chiarito nelle precedenti sezioni, la progettazione dell'intera applicazione è stata fortemente 
        			guidata dalla strutturazione a 4 livelli che le stesse specifiche <productname> Java EE </productname> suggeriscono.
        			E' stato quindi naturale identificare l'area di ingerenza del livello business nel dominio di lavoro dell'applicazione di
        			negozio virtuale di libri, delegando così ad altri livelli il compito di presentare i contenuti. Tuttavia
        			quella che sembrebbe una decisione scontata non è in realtà così diffusa: per ragioni d'opportunità
        			si assiste, nella pratica comune, ad un accoppiamento eccessivo tra i due livelli. Infatti, in applicazioni simili, la
        			gestione del carrello degli acquisti è spesso ad appannaggio esclusivo del livello web quando invece sarebbe
        			chiara competenza del livello business. 
        			Questa accurata distinzione delle responsabilità ha permesso di ottenere due risultati progettuali molto significativi:
        			<orderedlist>
        			<listitem> alta coesione all'interno degli stessi livelli; </listitem>
        			<listitem> basso accoppiamento tra i livelli. </listitem>
        			</orderedlist>
        			La scelta di definire un formato XML per i messaggi di scambio tra la presentazione e il business li ha resi ancor 
        			più indipendenti.
        		</para>
        		<para>
        			Un'attenzione particolare durante la progettazione è stata posta anche per quanto riguarda gli aspetti connessi
        			alle prestazioni e alle tolleranze ai guasti. <productname> JBOSS AS 5.1.GA </productname> offre in questo senso importantissimi 
        			ausili tecnologici che hanno permesso di ottenere componenti ad altà disponibilità, quanto più replicati fra i nodi del cluster.
        		</para>
        	</section>
   	        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        	<section>
       			<title>Scelte architetturali</title>       			
        			<para>
        				Il livello business è stato progettato secondo i criteri di modularità che fino ad ora hanno contraddistinto
        				l'applicazione. In <xref linkend="business_package" /> è possibile osservare il diagramma complessivo dei pacchetti
        				costituenti questo livello. L'elenco sottostante chiarisce le responsabilità per ciascun pacchetto:
        				<itemizedlist>
        				<listitem><para><filename>g8.bookshop.business.ws</filename>: espone tramite web service stateless i servizi
        				offerti dal livello business;</para></listitem>
        				<listitem><para><filename>g8.bookshop.business.um</filename>: gestisce gli utenti e ne mantiene lo stato nel negozio virtuale;</para></listitem>
        				<listitem><para><filename>g8.bookshop.business.core</filename>: definisce le entità, in senso lato, del business congiuntamente alle operazioni che le coinvolgono;</para></listitem>
        				<listitem><para><filename>g8.bookshop.business.persistence</filename>: costituisce il punto di accesso verso il livello informativo (contiene tutte le entity bean);</para></listitem>
        				<listitem><para><filename>g8.bookshop.business.util</filename>: offre alcune funzioni di utilità per tutto il livello business.</para></listitem>
        				</itemizedlist>
        				Prima di addentrarsi completamente nei dettagli implementativi è opportuno chiarire alcuni aspetti chiave al fine
        				di apprezzare al meglio la soluzione proposta.
        				Allo stato attuale dell'arte, le uniche session bean esponibili tramite web service sono le bean stateless.
        				Questo fatto ha comportato alcune complicazioni alla progettazione del livello business dal momento che è richiesto 
        				il mantenimento di alcune informazioni di stato, come ad esempio il carrello. Nella fattispecie si è resa necessaria
        				la realizzazione di un servizio singleton, il cui stato fosse sia condiviso tra i diversi client, sia preservato
        				tra le diverse richieste. Nel prosieguo il lettore troverà spiegazioni più dettagliate.
        				
        			</para>
        			<figure xml:id="business_package">
		                <title>
		                    <filename>g8.bookshop.business</filename>
		                </title>
		                <mediaobject>
		                    <imageobject role="fo">
		                        <imagedata fileref="DiagrammiBusiness/business_package.svg" align="center"
		                            depth="250pt" format="SVG"/>
		                    </imageobject>
		                    <imageobject role="dblatex">
		                        <imagedata fileref="DiagrammiBusiness/business_package.pdf" align="center"
		                            depth="250pt" format="PDF"/>
		                    </imageobject>
		                </mediaobject>
		            </figure>
        			<para>
        				Il pacchetto <filename>g8.bookshop.business.ws</filename> è composto
        				da tre bean stateless, tutte esposte come web service:
        				<itemizedlist>
        				<listitem><para><filename>CatalogueService.java</filename>: espone i metodi per l'accesso al catalogo dei libri;</para></listitem>
        				<listitem><para><filename>ShoppingCartService.java</filename>: espone i metodi per la gestione del carrello del cliente;</para></listitem>
        				<listitem><para><filename>UserManagerService.java</filename>: espone i metodi per la autenticazione e la disconnessione dell'utente.</para></listitem>
        				</itemizedlist>  
        			</para>
					<figure xml:id="business_ws">
		                <title>
		                    <filename>g8.bookshop.business.ws</filename>
		                </title>
		                <mediaobject>
		                    <imageobject role="fo">
		                        <imagedata fileref="DiagrammiBusiness/business_ws.svg" align="center"
		                            format="SVG"/>
		<!--                        <imagedata fileref="DiagrammiBusiness/business_ws.png" align="center"
		                            format="PNG"/>-->
		                    </imageobject>
		                    <imageobject role="dblatex">
		                        <imagedata fileref="DiagrammiBusiness/business_ws.pdf" align="center"
		                            depth="500pt" format="PDF"/>
		                    </imageobject>
		                </mediaobject>
		            </figure>
        			<para>
        				Il pacchetto <filename>g8.bookshop.business.um</filename> contiene la classe 
        				<filename>UserManager.java</filename> che 
        				implementa il servizio singleton per la gestione degli utenti e del loro stato.
        				In particolare tramite una <filename>HashMap</filename> mantiene gli utenti che sono al momento
        				presenti nel negozio virtuale. L'<filename>HashMap</filename>
        				in questione associa a ciascun identificativo di sessione un utente. Come si vedrà
        				nel seguito, il carrello è mantenuto all'interno della bean che rappresenta il cliente.
        				Infine il gestore degli utenti è anche il responsabile dell'autenticazione e della disconnessione
        				dei clienti.
       				</para>
       				<para>
        				La bean <filename>UserManagerAdaptor.java</filename>, invece, fornisce metodi convenienti
        				per accedere ai servizi offerti dal gestore degli utenti.
					</para>
					<figure xml:id="business_um">
		                <title>
		                    <filename>g8.bookshop.business.um</filename>
		                </title>
		                <mediaobject>
		                    <imageobject role="fo">
		                        <imagedata fileref="DiagrammiBusiness/business_um.svg" align="center"
		                            depth="350pt" format="SVG"/>
		                    </imageobject>
		                    <imageobject role="dblatex">
		                        <imagedata fileref="DiagrammiBusiness/business_um.pdf" align="center"
		                            depth="350pt" format="PDF"/>
		                    </imageobject>
		                </mediaobject>
		            </figure>
					<para>
						Il pacchetto <filename>g8.bookshop.business.core</filename> contiene tutte le bean che rappresentano
						le entità del business che non hanno necessità di essere persistenti ma che comunque devono
						mantenere uno stato.
						In particolare si è codificato tramite le bean <filename>Guest</filename> e <filename>Customer</filename>
						le due diverse tipologie di clienti che possono accedere al negozio virtuale di libri, cioè il visitatore occasionale
						e il cliente (per il quale è prevista l'autenticazione). Chiaramente solo il cliente possiede il carrello (<filename>ShoppingCart</filename>)
						che è costituito da un insieme di ordini (<filename>Order</filename>), cioè una coppia libro, quantità.
					</para>
					<para>
					</para>
					<figure xml:id="business_core">
		                <title>
		                    <filename>g8.bookshop.business.core</filename>
		                </title>
		                <mediaobject>
		                    <imageobject role="fo">
		                        <imagedata fileref="DiagrammiBusiness/business_core.svg" align="center"
		                            depth="500pt" format="SVG"/>
		                    </imageobject>
		                    <imageobject role="dblatex">
		                        <imagedata fileref="DiagrammiBusiness/business_core.pdf" align="center"
		                            depth="500pt" format="PDF"/>
		                    </imageobject>
		                </mediaobject>
		            </figure>
					<para>
					 Il package <filename>g8.bookshop.business.persistence</filename> contiene le entità EJB 3.0 
					</para>
					<figure xml:id="business_persistence">
		                <title>
		                    <filename>g8.bookshop.business.persistence</filename>
		                </title>
		                <mediaobject>
		                    <imageobject role="fo">
		                        <!--                        <imagedata fileref="DiagrammiBusiness/persistence.png" align="center"
		                            format="PNG"/>-->
		                        <imagedata fileref="DiagrammiBusiness/business_persistence.svg" align="center"
		                            depth="300pt" format="SVG"/>
		                    </imageobject>
		                    <imageobject role="dblatex">
		                        <imagedata fileref="DiagrammiBusiness/business_persistence.pdf" align="center"
		                            depth="300pt" format="PDF"/>
		                    </imageobject>
		                </mediaobject>
		            </figure>
		            <para>
		            	<filename>g8.bookshop.business.util</filename>
        			</para>
					<figure xml:id="business_util">
		                <title>
		                    <filename>g8.bookshop.business.util</filename>
		                </title>
		                <mediaobject>
		                    <imageobject role="fo">
		                        <imagedata fileref="DiagrammiBusiness/business_util.svg" align="center"
		                            depth="350pt" format="SVG"/>
		                    </imageobject>
		                    <imageobject role="dblatex">
		                        <imagedata fileref="DiagrammiBusiness/business_util.pdf" align="center"
		                            depth="350pt" format="PDF"/>
		                    </imageobject>
		                </mediaobject>
		            </figure>
		            
        			<para>
        				dipendenze fra package
        				diagramma "package con relazioni dettagliate"
       				</para>
					<figure xml:id="business_package_relations">
		                <title>
		                    <filename>g8.bookshop.business</filename>
		                </title>
		                <mediaobject>
		                    <imageobject role="fo">
		                        <imagedata fileref="DiagrammiBusiness/business_package_relations.svg" align="center"
		                            depth="300pt" format="SVG"/>
		                    </imageobject>
		                    <imageobject role="dblatex">
		                        <imagedata fileref="DiagrammiBusiness/business_package_relations.pdf" align="center"
		                            depth="300pt" format="PDF"/>
		                    </imageobject>
		                </mediaobject>
		            </figure>
       			</section>
        	<section>
        		<title>Scelte di schieramento</title>
        		<section>
        			<title>Servizio singleton ad alta disponibilita`</title>
        			<para>
  						il business necessita di informazioni che siano application-wide e non session-wide
					</para>
   					<para>
  						servizio ha-singleton realizzato grazie a Jboss e HASingletonController (gestione failover rapido)
 					</para>
   					<para>
  						logica nel diagramma sequenza authenticate
	<!--        		xml:id="sequence_business_auth"-->
        			</para>
  		            <figure xml:id="sequence_business_auth">
		                <title> Diagramma di sequenza </title>
		                <mediaobject>
		                    <imageobject role="fo">
		                        <imagedata fileref="DiagrammiBusiness/sequence_business_auth.svg"
		                            align="center" depth="450pt" format="SVG"/>
		                    </imageobject>
		                    <imageobject role="dblatex">
		                        <imagedata fileref="DiagrammiBusiness/sequence_business_auth.pdf"
		                            align="center" depth="350pt" format="PDF"/>
		                    </imageobject>
		                </mediaobject>
		            </figure>
        		</section>
        		<section>
       				<title>Alta replicazione</title>
       				<para>
						entity bean: replicate grazie alla cache di secondo livello offerta da hibernate con politica ad alte prestazioni (sola lettura)
					</para>
  					<para>
						session bean: bilanciamento di carico in fase di risoluzione nomi HAJNDI
					</para>
   					<para>
						stateful session bean: distribuite grazie alla funzionalita` clustered di JBossCache
       				</para>
        		</section>
       		</section>
       		<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
   			<section>
    			<title>Scelte progettuali minori</title>
    			<para>
    				design pattern utilizzati
    			</para>
   				<para>
    				adapter allo user manager affiche` sia utilizzabile tramite un'interfaccia conveniente
   				</para>
   				<para>
    				locator incapsula la ricerca delle bean per fattorizzare la funzionalita`, in modo da centralizzare le ricerche delle EJB
   				</para>
   			</section>
        	<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        </section>
    </chapter>
</book>
